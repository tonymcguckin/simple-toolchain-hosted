version: '2'

messages:
  $i18n: locales.yml

template:
  name:
    $ref: "$env.byoc_name === undefined ? '#/messages/template.name' : '#/messages/template.byoc_name'"

  description:
    $ref: "#/messages/template.description"

  getting_started:
      $ref: "#/messages/template.description"

  info:
    git url: >
        '[' + $env.repository + '](' + $env.repository + ')'
    git branch: >
        $env.branch ?
          '[' + $env.branch + ']('+ $env.repository + '/tree/' + $env.branch + ')' :
          '[master]('+ $env.repository + '/tree/master)'

toolchain:
  name: "DYML - $env Scripting: API Extensions"

services:
  sample-repo:
    $switch:
      - $default: hostedgit
        service_id: hostedgit
        parameters:
          test: foo
          
          #t1: "$env.createObject(999.997766)"
          #t2: "$env.createObject(true, 'mykey')"
          #t3: "$env.createObject({ a: $env.byoc_name })"
          #t4: "$$env.createObject({ x: $env.byoc_name, y: true })"
          
          #t5: "$env.load('params.dyml')"
          #t6: "$env.load('schedule.dyml', 'services.sample-build.parameters.configuration.env.schedule')"
          #t7: "$env.load('env.dyml', 'form.pipeline.parameters.env')"
          
          #t8: "if($env.byoc_name == 'f') $env.branch; else '{{repository}}';"
          #t9: "if($env.byoc_name !== undefined){ $env.branch; } else if($env.env == 'eu'){ 999; };"

form:
  pipeline:
    parameters:
      ZONE: >
        if($env.env == 'eu'){
          $env.load('build-eu.dyml', 'services');
        } else if($env.env == 'us'){
            $env.load('build-usa.dyml');
        } else {
          'na'
        }
      env_key: "if($env.env !== undefined){ $env.env } else { 'na' }"
    schema:
      $ref: deploy.json
