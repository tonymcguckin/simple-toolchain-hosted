version: '2'

messages:
  $i18n: locales.yml

template:
  name:
    $ref: "#/messages/template.name"
    #$ref: "#/messages/template.description"$ref: "$env.byoc_name === undefined ? '#/messages/template.name' : '#/messages/template.byoc_name'"

  description:
    $ref: "#/messages/template.description"

  getting_started:
      $ref: "#/messages/template.description"
  #info:
   # git url: >-
    #  $env.repository ? '[' + $env.repository + '](' + $env.repository + ')' : "[https://github.com/tonymcguckin/simple-toolchain-hosted](https://github.com/tonymcguckin/simple-toolchain-hosted)"
    #git branch: >-
     # $env.repository && $env.branch ? '[' + $env.branch + ']('+ $env.repository + '/tree/' + $env.branch + ')': "[flavour3](https://github.com/tonymcguckin/simple-toolchain-hosted/tree/flavour3)"

toolchain:
  name: DYML

services:
  sample-repo:
    $switch:
      - $expr: hostedgit
      
      - $default: hostedgit
      
      - $case: githubpublic
        service_id: githubpublic
        parameters: {}
        
      - $case: hostedgit
        service_id: hostedgit
        parameters:
          
          t1: "'use strict'; $env.createObject(999.997766)"
          #t2: "$env.createObject(true, 'mykey')"
          #t3: "$env.createObject({ a: $env.byoc_name })"
          #t4: "$$env.createObject({ x: $env.byoc_name, y: true })"
          
          t5: "$env.load('params.dyml')"
          #t6: "$env.load('schedule.dyml', 'services.sample-build.parameters.configuration.env.schedule')"
          #t7: "$env.load('env.dyml', 'form.pipeline.parameters.env')"
          
          #t8: "if($env.byoc_name == 'f') $env.branch; else '{{repository}}';"
          #t9: "if($env.byoc_name !== undefined){ $env.branch; } else if($env.env == 'eu'){ 999; };"

  sample-build:
    service_id: pipeline
    parameters:
      services:
        - sample-repo
      name: SAMPLE-BUILD
      ui-pipeline: true
      configuration:
        content:
          $text: pipeline.yml
        env:
          SAMPLE_REPO: sample-repo
          #ZONE: "if($env.env == 'eu'){ $env.load('build-eu.dyml'); } else if($env.env == 'us'){ $env.load('build-usa.dyml'); } else { 'na' }"
          #CF_APP_NAME: $env.byoc_name || '{{form.pipeline.parameters.prod-app-name}}'
          #PROD_SPACE_NAME: $env.prod_space || '{{form.pipeline.parameters.prod-space}}'
          #PROD_ORG_NAME: $env.prod_org || '{{form.pipeline.parameters.prod-organization}}'
          #PROD_REGION_ID: $env.prod_region || '{{form.pipeline.parameters.prod-region}}'
          #API_KEY: '{{form.pipeline.parameters.api-key}}'
        execute: true

  webide:
    service_id: orion

form:
  pipeline:
    parameters: {}
      #env_key: "if($env.env !== undefined){ $env.env } else { 'na' }"
    schema:
      $ref: deploy.json
